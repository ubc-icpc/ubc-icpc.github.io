<!DOCTYPE html>
<html>
<head>
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css" rel="stylesheet" type="text/css" />
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css" rel="stylesheet" type="text/css" />
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script>
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCpp.js" type="text/javascript"></script>
<style type="text/css">.syntaxhighlighter{overflow-y: hidden !important; overflow-x: auto !important;}</style></head>
<body>
<pre class="brush: cpp">
#include &lt;bits/stdc++.h&gt;
using namespace std;

int limit(int i, int s) {
	if (i &lt; 0) return s + i;
	if (i &gt;= s) return i - s;
	return i;
}

vector&lt;vector&lt;int&gt; &gt; blur(vector&lt;vector&lt;int&gt; &gt; i, int w, int h) {
	vector&lt;vector&lt;int&gt; &gt; n(h, vector&lt;int&gt;(w, 0));
	for (int r = 0; r &lt; h; r++) {
		for (int c = 0; c &lt; w; c++) {
			int sum = 0;
			for (int dr = -1; dr &lt;= 1; dr++) {
				for (int dc = -1; dc &lt;= 1; dc++) {
					sum += i[limit(r + dr, h)][limit(c + dc, w)];
				}
			}
			n[r][c] = sum;
		}
	}
	return n;
}

int main() {
	int w; int h; int b; cin &gt;&gt; w &gt;&gt; h &gt;&gt; b;
	vector&lt;vector&lt;int&gt; &gt; i(h, vector&lt;int&gt;(w, 0));

	for (int r = 0; r &lt; h; r++) {
		for (int c = 0; c &lt; w; c++) {
			cin &gt;&gt; i[r][c];
		}
	}

	while (b--) {
		i = blur(i, w, h);
	}

	set&lt;int&gt; u;
	for (int r = 0; r &lt; h; r++) {
		for (int c = 0; c &lt; w; c++) {
			u.insert(i[r][c]);
		}
	}

	cout &lt;&lt; u.size() &lt;&lt; endl;
}</pre>
</body>
<script type="text/javascript">SyntaxHighlighter.all()</script></html>
